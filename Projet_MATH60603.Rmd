---
title: 'Projet '
author: "Jean Guirguis (11290393) et David Gascon (xxxxxxx)"
date: "xx/12/2020"
output:
  html_document: default
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Librairies
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)
```

# Exploration des données

```{r}
# Importation des données

train=read.csv("data/churn-bigml-80.csv")
test=read.csv("data/churn-bigml-20.csv")
```


```{r}
summary(train)
```
## Réencodage des variables "State", "International.plan" et "Voice.mail.plan" en facteur. La variable d'intérêt est réencodée en variable logique, à savoir que les valeurs "vrai" sont codées "1" et les valeurs "faux" sont codées en 0
```{r}
### TRAIN ####
#transformation des variables "character" en "facteur"

train$State=as.factor(train$State)
train$International.plan=as.factor(train$International.plan)
train$Voice.mail.plan=as.factor(train$Voice.mail.plan)

#transformation variable d'intérêt en variable logique
train$Churn=as.logical(train$Churn)

### TEST ####
#transformation des variables "character" en "facteur"

test$State=as.factor(test$State)
test$International.plan=as.factor(test$International.plan)
test$Voice.mail.plan=as.factor(test$Voice.mail.plan)

#transformation variable d'intérêt en variable logique
test$Churn=as.integer(test$Churn)
```
## Étude descriptive des données

```{r}
# fonction 
analyse_table = function (nom,variable,nb_donne)
{
  table_temporaire= table(variable)
  table_temporaire = as.data.frame(table_temporaire)
  table_temporaire = data.frame(table_temporaire,pourcentage=round(table_temporaire[2]/nb_donne*100, digit =2))
  names(table_temporaire)[3] = "% Freq"
  names(table_temporaire)[1] = nom
  #table_temporaire = head(table_temporaire[order(-table_temporaire[3]),],3)
  table_temporaire = table_temporaire[order(-table_temporaire[3]),]
  return(table_temporaire)
}

analyse_table('State',train$State,nrow(train))
analyse_table('International.plan',train$International.plan,nrow(train))
analyse_table('Voice.mail.plan',train$Voice.mail.plan,nrow(train))
analyse_table('Churn',train$Churn,nrow(train))
analyse_table('Area.code',train$Area.code,nrow(train))
```


```{r}
for (i in 1:length(colnames(train)))
{
  if (i != 1 & i !=3  & i != 4 & i != 5 & i !=length(colnames(train)))
  {
    hist(train[,i], main = (colnames(train)[i] ))
    plot(train[,i], main = (colnames(train)[i] ))
  }
}
```


REMARQUE : Si on conserve les varialbes Customer.service.calls et total.intl,calls en variables numériques, il faudra surement prendre le log de ces variables car elles sont asymetriques à droite.!!

## Analyse descriptive des données 

```{r}
summary(train)
```

Le dataset d'entraînement ne contient aucune valeurs manquantes. il y a 15 variables continues, 3 variables catégorielles, et une variables binaires

```{r}
round(mean(train$Churn),digits=2)
```
Le pourcentage de clients ayant quittés la compagnie est de 15%.\

```{r}
library("plotly")
library("corrplot")
```

```{r}
corrplot(cor(train[,c(2,3,6:19)]), method = "color", addCoef.col="grey", order = "AOE",tl.cex=0.75,tl.col="black",number.cex = 0.5)
```
Les varaibles du dataset sont faiblement corrélées à l'exception des variables indiquant le nombre de muinutes consommés et les frais chargés associés, comme les varaibles : "Total.night charge" et "Total.night.minutes". Comme ces variables ont une corrélation parfaites, nous décidons de supprimer du dataset les variables "charge". Ce qui revient à supprimer 4 variables du dataset.

```{r}
library(ggplot2)
ggplot(train, aes(x = Churn, fill=Customer.service.calls)) +
  geom_bar( ) +
  xlab("client ayant quitté") + ylab("Customer.service.calls") +
  ggtitle("Total de client ayant quitté")

```

```{r, message=FALSE}
library(dplyr)
library(usmap)
us.map=train
names(us.map)[names(us.map)=="State"]="state"
us.map = data.frame(us.map)

state.churn=us.map %>%
  group_by(state) %>%
  summarise(pct_perte.client = mean(Churn))
```

```{r}
us.map = data.frame(us.map)

plot_usmap(regions="state", data=state.churn, values = "pct_perte.client", color="black")+
  scale_fill_continuous(low = "green", high = "red", name = "pct_perte.client")+ 
  labs(title = "Perte clientèle États-Unis", subtitle = "Opérateur Orange télécom")+
  theme(legend.position = "right")

```
On constate que les états du Texas et New Jersey sont les états ayant perdus le plus de clientèle, avec un pourcentage de perte supérieur à 25%.\
